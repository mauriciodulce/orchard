{#
  Section component rendering a gallery and related text content.
  - Images are conditionally rendered based on validity.
  - Layout follows a 2-row CSS grid with featured image.
  - Text content supports optional title, body, and highlight sections.
#}
{% embed '@orchard/components/section.html.twig' with { class: 'overflow-x-clip no-space-t' } %}
  {% block slot %}
    <div class="span-content stack-20 lg:stack-24" >
      <div class="grid lg:grid-cols-12 gap-x-fluid-grid-gap gap-8">
        {#
          Filter out valid gallery items.
          Ensures only items with an associated entity (#item) are rendered.
        #}
        {% set valid_images = [] %}
        {% for item in content.field_gallery %}
          {% if item['#item'] %}
            {% set valid_images = valid_images | merge([item]) %}
          {% endif %}
        {% endfor %}

        {# Render image grid if any valid images exist #}
        {% if valid_images is not empty %}
          <div class="stack-8 lg:col-span-8">
            <div class="grid grid-cols-6 grid-rows-2 gap-2 [&_img]:w-full [&_img]:h-full [&_img]:object-cover" role="list">
              {% for item in valid_images %}
                {#
                  First image spans two rows (featured), rest are regular.
                  Limit display to 3 images.
                #}
                {% if loop.index <= 3 %}
                  <figure
                    role="listitem"
                    class="overflow-hidden {{ loop.index == 1 ? 'col-span-3 row-span-2' : 'col-span-3 row-span-1' }}"
                  >
                    {{ item }}
                  </figure>
                {% endif %}
              {% endfor %}
            </div>
          </div>
        {% endif %}

        {# Textual content block including main title, body, and highlight block #}
        {% if content.field_title['#items'] is not empty or content.body is defined or content.field_highlight_title['#items'] is not empty %}
          <div class="lg:col-span-4 self-stretch space-y-5 xl:space-y-8">

            {# Section title #}
            {% if content.field_title['#items'] is not empty %}
              <header>
                <h2 class="uppercase tracking-wider text-2xl xl:text-3xl leading-[1.1] border-b border-current pb-5 xl:pb-7">
                  {{ content.field_title['#items'][0].value }}
                </h2>
              </header>
            {% endif %}

            {# Body text content #}
            {% if content.body is defined and content.body is not empty %}
              <article class="prose text-lg xl:text-xl font-light">
                {{ content.body }}
              </article>
            {% endif %}

            {# Highlight block with optional title and description #}
            {% if content.field_highlight_title['#items'] is not empty or content.field_highlight_description is defined %}
              <div class="grid space-y-2.5">
                {% if content.field_highlight_title['#items'] is not empty %}
                  <h3 class="uppercase text-scarlet font-bold text-sm tracking-wide">
                    {{ content.field_highlight_title['#items'][0].value }}
                  </h3>
                {% endif %}
                {% if content.field_highlight_description is defined %}
                  <article class="prose text-lg lg:text-xl">
                    {{ content.field_highlight_description.0 }}
                  </article>
                {% endif %}
              </div>
            {% endif %}

          </div>
        {% endif %}

      </div>
    </div>
  {% endblock %}
{% endembed %}
